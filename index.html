<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roman Predictor Pro ‚öΩüî•</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f2f2f2;
            margin: 0;
            padding: 0;
        }
        .container {
            background: white;
            padding: 25px;
            margin: 20px auto;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.15);
        }
        input, select, button {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border-radius: 8px;
            font-size: 16px;
            border: 1px solid #ccc;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 18px;
        }
        button:hover {
            background: #005fcc;
        }
        .good {
            background: #e8ffe8;
            padding: 12px;
            margin-top: 15px;
            border-left: 4px solid #35b331;
            border-radius: 6px;
        }
        .history-box {
            background: #fff8e1;
            padding: 12px;
            margin-top: 20px;
            border-left: 4px solid #ffc107;
            border-radius: 6px;
        }
    </style>
</head>

<body>

<div class="container">

    <h2>Roman Predictor Pro ‚öΩüî•</h2>
    <p>Inteligentn√≠ sportovn√≠ p≈ôedpovƒõdi pomoc√≠ AI</p>

    <h3>üîë Vlo≈æ sv≈Øj OpenAI API kl√≠ƒç:</h3>
    <input id="apiKey" type="password" placeholder="sk-xxxxxxxxxxxxxxxx">
    <button onclick="saveKey()">Ulo≈æit kl√≠ƒç</button>

    <h3>‚öΩ Vyber sport:</h3>
    <select id="sport">
        <option value="fotbal">Fotbal</option>
        <option value="hokej">Hokej</option>
        <option value="tenis">Tenis</option>
        <option value="basketbal">Basketbal</option>
        <option value="americky_fotbal">Americk√Ω fotbal</option>
        <option value="bojove_sporty">Bojov√© sporty</option>
    </select>

    <h3>üìù Zadej turnaj nebo z√°pas:</h3>
    <input id="event" type="text" placeholder="Nap≈ô.: ATP Bergamo, Slavia‚ÄìPlze≈à, UFC 301 ...">

    <button onclick="getPrediction()">Z√≠skat p≈ôedpovƒõƒè</button>

    <div id="result"></div>

    <h3>üìö Historie p≈ôedpovƒõd√≠</h3>
    <div id="history"></div>

</div>

<script>

function saveKey() {
    const key = document.getElementById("apiKey").value.trim();
    if (key.length < 10) {
        alert("‚ö†Ô∏è API kl√≠ƒç nevypad√° validnƒõ!");
        return;
    }
    localStorage.setItem("apiKey", key);
    alert("üîê API kl√≠ƒç ulo≈æen!");
}

window.onload = () => {
    const savedKey = localStorage.getItem("apiKey");
    if (savedKey) {
        document.getElementById("apiKey").value = savedKey;
    }
    loadHistory();
};


async function getPrediction() {
    const apiKey = localStorage.getItem("apiKey");
    const sport = document.getElementById("sport").value;
    const event = document.getElementById("event").value.trim();

    if (!apiKey) {
        alert("‚ùó Nejprve vlo≈æ sv≈Øj OpenAI API kl√≠ƒç!");
        return;
    }
    if (event.length < 3) {
        alert("‚ùó Zadej n√°zev turnaje nebo z√°pasu!");
        return;
    }

    document.getElementById("result").innerHTML = "<p>‚è≥ Naƒç√≠t√°m p≈ôedpovƒõƒè...</p>";

    try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + apiKey
            },
            body: JSON.stringify({
                model: "gpt-4o-mini",
                messages: [{
                    role: "user",
                    content: `Udƒõlej sportovn√≠ p≈ôedpovƒõƒè. SPORT: ${sport}. Z√ÅPAS/TURNAJ: ${event}.`
                }]
            })
        });

        const data = await response.json();

        const text = data.choices[0].message.content;

        document.getElementById("result").innerHTML =
            `<div class='good'><b>‚úÖ P≈ôedpovƒõƒè:</b><br>${text}</div>`;

        saveToHistory(event, sport, text);

    } catch (err) {
        document.getElementById("result").innerHTML =
            `<div style="color:red;">Chyba API: ${err}</div>`;
    }
}

function saveToHistory(event, sport, text) {
    const old = JSON.parse(localStorage.getItem("history") || "[]");

    old.push({
        time: new Date().toLocaleString(),
        event,
        sport,
        text
    });

    localStorage.setItem("history", JSON.stringify(old));
    loadHistory();
}

function loadHistory() {
    const box = document.getElementById("history");
    const h = JSON.parse(localStorage.getItem("history") || "[]");

    if (h.length === 0) {
        box.innerHTML = "<i>≈Ω√°dn√° historie zat√≠m nen√≠‚Ä¶</i>";
        return;
    }

    box.innerHTML = h.slice().reverse().map(item => `
        <div class="history-box">
            <b>üìå ${item.event} (${item.sport})</b><br>
            <small>${item.time}</small><br><br>
            ${item.text}
        </div>
    `).join("");
}

</script>

</body>
</html>
